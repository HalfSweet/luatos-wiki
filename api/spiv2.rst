spiv2 - spiv2操作库
===================

   本页文档由\ `这个文件 <https://gitee.com/openLuat/LuatOS/tree/master/luat/modules/luat_lib_spiv2.c>`__\ 自动生成。如有错误，请提交issue或帮忙修改后pr，谢谢！

spiv2.bus_setup(id)
-------------------

设置并启用SPI总线

**参数**

========== ===============
传入值类型 解释
========== ===============
int        SPI总线ID,例如0
========== ===============

**返回值**

========== ========================
返回值类型 解释
========== ========================
int        成功返回0,否则返回其他值
========== ========================

**例子**

.. code:: lua

   -- 初始化spi总线
   spiv2.bus_setup(0)

--------------

spi_v2.device_setup(bus,id, cs, CPHA, CPOL, dataw, bandrate, bitdict, ms, mode)
-------------------------------------------------------------------------------

设置并启用SPI设备

**参数**

========== ================================================
传入值类型 解释
========== ================================================
int        SPI号,例如0
int        CS 片选脚
int        CPHA 默认0,可选0/1
int        CPOL 默认0,可选0/1
int        数据宽度,默认8bit
int        波特率,默认2M=2000000
int        大小端, 默认spi.MSB, 可选spi.LSB
int        主从设置, 默认主1, 可选从机0. 通常只支持主机模式
int        工作模式, 全双工1, 半双工0, 默认全双工
========== ================================================

**返回值**

========== ========================
返回值类型 解释
========== ========================
int        成功返回0,否则返回其他值
========== ========================

**例子**

.. code:: lua

   -- 初始化spi设备
   spi_v2.device_setup(0,0,20,0,0,8,2000000,spi.MSB,1,1)

--------------

spiv2.bus_close(id)
-------------------

关闭指定的SPI总线

**参数**

========== ===============
传入值类型 解释
========== ===============
int        SPI总线号,例如0
========== ===============

**返回值**

========== ========================
返回值类型 解释
========== ========================
int        成功返回0,否则返回其他值
========== ========================

**例子**

.. code:: lua

   -- 初始化spi总线
   spiv2.bus_close(0)

--------------

spiv2.device_close(id)
----------------------

关闭指定的SPI设备

**参数**

========== ===========
传入值类型 解释
========== ===========
int        SPI号,例如0
========== ===========

**返回值**

========== ========================
返回值类型 解释
========== ========================
int        成功返回0,否则返回其他值
========== ========================

**例子**

.. code:: lua

   -- 初始化spi设备
   spiv2.device_close(0)

--------------

spiv2.transfer(id, send_data[, len])
------------------------------------

传输SPI数据

**参数**

============ ===========================================================
传入值类型   解释
============ ===========================================================
int          SPI号,例如0
string/zbuff 待发送的数据，如果为zbuff数据，则会从对象所处的指针处开始读
int          可选。待发送数据的长度，默认为data长度
============ ===========================================================

**返回值**

========== ==============================
返回值类型 解释
========== ==============================
string     读取成功返回字符串,否则返回nil
========== ==============================

**例子**

.. code:: lua

   -- 初始化spi
   spiv2.device_setup(0,0,nil,0,0,8,2000000,spi.MSB,1,1)
   local recv = spiv2.transfer(0, "123")--发送123,并读取数据

   local buff = zbuff.create(1024, 0x33) --创建一个初值全为0x33的内存区域
   local recv = spiv2.transfer(0, buff)--把zbuff数据从指针开始，全发出去,并读取数据

--------------

spiv2.recv(id, size)
--------------------

接收指定长度的SPI数据

**参数**

========== ===========
传入值类型 解释
========== ===========
int        SPI号,例如0
int        数据长度
========== ===========

**返回值**

========== ==============================
返回值类型 解释
========== ==============================
string     读取成功返回字符串,否则返回nil
========== ==============================

**例子**

.. code:: lua

   -- 初始化spi
   spiv2.device_setup(0,0,nil,0,0,8,2000000,spi.MSB,1,1)
   local recv = spiv2.recv(0, 4)--接收4字节数据

--------------

spiv2.send(id, data[, len])
---------------------------

发送SPI数据

**参数**

============ ===========================================================
传入值类型   解释
============ ===========================================================
int          SPI号,例如0
string/zbuff 待发送的数据，如果为zbuff数据，则会从对象所处的指针处开始读
int          可选。待发送数据的长度，默认为data长度
============ ===========================================================

**返回值**

========== ========
返回值类型 解释
========== ========
int        发送结果
========== ========

**例子**

.. code:: lua

   -- 初始化spi
   spiv2.setup(0,0,nil,0,0,8,2000000,spi.MSB,1,1)
   local result = spiv2.send(0, "123")--发送123

   local buff = zbuff.create(1024, 0x33) --创建一个初值全为0x33的内存区域
   local result = spiv2.send(0, buff)--把zbuff数据从指针开始，全发出去

--------------
